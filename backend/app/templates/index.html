<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shurahub - Ask the Council</title>
    <link rel="stylesheet" href="/static/css/globals.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/citations.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet">
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#8B5CF6",
                        "secondary": "#EC4899",
                        "background-light": "#F9FAFB",
                        "background-dark": "#111827",
                        "card-dark": "#1F2937",
                        "status-con": "#EF4444",
                        "status-neutral": "#F59E0B",
                        "status-pro": "#8B5CF6",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.75rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px" },
                },
            },
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/static/js/theme.js" defer></script>
    {% include 'analytics.html' %}
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/" class="logo-link">
                    <div class="logo-icon-wrapper">
                        <img src="/static/favicon.svg" alt="Shurahub" width="24" height="24">
                    </div>
                    <span class="logo-text">Shurahub</span>
                </a>
                <div class="tagline-divider"></div>
                <div class="tagline">
                    <span>Decision</span>
                    <span>Intelligence</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <button id="new-debate-btn" class="nav-item active">
                    <span class="material-icons-outlined">add_circle_outline</span>
                    New Debate
                </button>
                <a href="/review" class="nav-item">
                    <span class="material-icons-outlined">history</span>
                    Debate Archive
                </a>

                {% if user %}
                <div class="history-section">
                    <div class="history-header">Recent Debates</div>
                    <div id="history-list" class="history-list">
                        <!-- Populated by JavaScript -->
                        <div class="history-loading">Loading...</div>
                    </div>
                </div>
                {% endif %}
            </nav>
            <div class="sidebar-footer">
                {% if user %}
                <a href="/logout" class="logout-link">
                    <span class="material-icons-outlined">logout</span>
                    Logout
                </a>
                {% else %}
                <a href="/login" class="login-link">
                    <span class="material-icons-outlined">login</span>
                    Login to save history
                </a>
                {% endif %}
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="chat-header">
                <div class="chat-header__left">
                    <button id="mobile-menu-btn" class="icon-button" aria-label="Toggle Menu">
                        <span class="material-icons-outlined">menu</span>
                    </button>
                    <a href="/" class="header-logo-mobile">
                        <div class="logo-icon-small">
                            <img src="/static/favicon.svg" alt="Shurahub" width="18" height="18">
                        </div>
                        <span class="logo-text-small">Shurahub</span>
                    </a>
                </div>
                <div class="chat-header__actions">
                    <button id="header-new-debate-btn" class="icon-button" aria-label="New Debate" title="New Debate">
                        <span class="material-icons-outlined">add</span>
                    </button>
                    {% if not user %}
                    <span class="guest-pill" title="You can use Shurahub without signing in. Responses won't be saved.">
                        Guest mode
                    </span>
                    {% endif %}
                    <button id="theme-toggle" class="icon-button" onclick="ThemeManager.toggle()"
                        aria-label="Toggle Theme">
                        <svg id="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" style="width: 20px; height: 20px;">
                            <!-- Icon set by JS -->
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Chat Area -->
            <div class="chat-shell">
                <div class="chat-status" id="chat-status">Connected</div>
                <div class="chat-messages" id="chat-messages">
                    <!-- Empty State -->
                    <div id="empty-state" class="flex flex-col flex-grow items-center justify-center text-center px-4 max-w-md mx-auto">
                        <div class="mb-8 w-full text-left">
                            <h2 class="text-3xl font-extrabold tracking-tight leading-tight mb-2">
                                Ask the <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Council</span>
                            </h2>
                            <p class="text-slate-500 dark:text-slate-400 text-sm leading-relaxed">
                                Describe your dilemma. The AI council will debate the pros, cons, and nuances for you.
                            </p>
                        </div>

                        <div class="w-full space-y-6">
                            <div class="group">
                                <label class="block text-sm font-semibold mb-2 text-left text-slate-900 dark:text-white" for="prompt-input">
                                    What are you trying to decide?
                                </label>
                                <div class="relative">
                                    <textarea id="empty-prompt-input" rows="4"
                                        class="w-full bg-slate-50 dark:bg-card-dark border border-slate-200 dark:border-white/10 rounded-xl px-4 py-3 text-base focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all resize-none shadow-sm text-slate-900 dark:text-white placeholder-slate-400"
                                        placeholder="e.g., Should I quit my job to start a bakery, or stay for the promotion?"></textarea>
                                    <div class="char-counter absolute bottom-3 right-3 text-xs text-slate-400 bg-white dark:bg-card-dark px-1 rounded">
                                        0/200
                                    </div>
                                </div>
                            </div>

                            <button id="empty-send-button" class="w-full bg-gradient-to-r from-primary to-secondary hover:opacity-90 active:scale-[0.98] transition-all text-white font-bold text-lg py-4 px-6 rounded-2xl shadow-lg flex items-center justify-center gap-2 group">
                                <span class="send-button-text">Start Debate</span>
                                <span class="material-symbols-outlined group-hover:translate-x-1 transition-transform">arrow_forward</span>
                            </button>

                            <!-- Quick Start Prompts -->
                            <div class="grid grid-cols-1 gap-3 mt-6">
                                <button class="quick-start-prompt flex items-center gap-3 p-4 rounded-xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-card-dark/50 hover:border-primary transition-all text-left"
                                    data-prompt="Should I quit my job to start a bakery, or stay for the promotion?">
                                    <span class="material-symbols-outlined text-primary text-xl">work</span>
                                    <span class="prompt-text text-sm font-medium text-slate-700 dark:text-slate-300">Quit job for bakery or stay for promotion?</span>
                                </button>
                                <button class="quick-start-prompt flex items-center gap-3 p-4 rounded-xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-card-dark/50 hover:border-primary transition-all text-left"
                                    data-prompt="Should I take the job offer or stay at my current company?">
                                    <span class="material-symbols-outlined text-primary text-xl">compare_arrows</span>
                                    <span class="prompt-text text-sm font-medium text-slate-700 dark:text-slate-300">Take the job offer or stay at current company?</span>
                                </button>
                            </div>

                            <div class="powered-by flex items-center justify-center gap-2 text-xs text-slate-400 mt-4">
                                <span class="material-symbols-outlined text-sm">bolt</span>
                                <span>Powered by Multi-Agent AI</span>
                            </div>
                        </div>
                    </div>
                    <!-- Scroll anchor for smooth auto-scrolling (ChatGPT-style) -->
                    <div id="scroll-anchor" class="scroll-anchor"></div>
                </div>

                <!-- Input Area -->
                <div class="chat-input-container" id="chat-input-container" style="display: none;">
                    <div class="chat-input-wrapper">
                        <label class="input-label" for="chat-prompt-input">What are you trying to decide?</label>
                        <div class="chat-input">
                            <textarea id="chat-prompt-input" rows="1"
                                class="w-full bg-transparent border-none text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-500"
                                placeholder="e.g., Should I quit my job to start a bakery, or stay for the promotion?"></textarea>
                            <div class="char-counter">0/200</div>
                        </div>
                    </div>
                    <button id="chat-send-button" class="send-button" aria-label="Start Debate">
                        <span class="send-button-text">Start Debate</span>
                        <span class="material-icons-outlined">arrow_forward</span>
                    </button>
                    <div class="chat-helper">Press Enter to send ‚Ä¢ Shift + Enter for a new line</div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <a href="#" class="bottom-nav-item active" id="nav-new">
                <span class="material-icons-outlined">add_circle_outline</span>
                <span>New</span>
            </a>
            <a href="/review" class="bottom-nav-item" id="nav-history">
                <span class="material-icons-outlined">history</span>
                <span>History</span>
            </a>
            <a href="{% if user %}/logout{% else %}/login{% endif %}" class="bottom-nav-item" id="nav-profile">
                <span class="material-icons-outlined">person_outline</span>
                <span>{% if user %}Logout{% else %}Profile{% endif %}</span>
            </a>
        </nav>
    </div>

    <!-- Message Templates -->
    <template id="user-message-template">
        <div class="message user-message">
            <div class="message-content"></div>
        </div>
    </template>

    <template id="shurahub-message-template">
        <div class="message shurahub-message w-full mt-4">
            <div class="message-content w-full">
                <!-- Golden Answer Summary Box (Visible at top of this result) -->
                <div class="summary-box mb-6">
                    <div class="relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-100 to-white dark:from-[#1e252e] dark:to-[#161c23] border border-primary/20 shadow-md">
                        <div class="absolute top-0 left-0 w-1 h-full bg-primary"></div>
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2 text-primary font-bold text-xs uppercase tracking-wider">
                                    <span class="material-symbols-outlined text-lg">auto_awesome</span>
                                    <span>Golden Answer</span>
                                </div>
                                <span class="confidence-pill bg-primary/10 text-primary text-[10px] font-bold px-2 py-0.5 rounded-full border border-primary/20">ANALYZING...</span>
                            </div>
                            <div class="summary-bullets space-y-2">
                                <!-- Populated by JS -->
                                <div class="flex gap-2 items-start animate-pulse">
                                    <div class="w-4 h-4 rounded bg-slate-200 dark:bg-slate-700 mt-1"></div>
                                    <div class="h-4 bg-slate-200 dark:bg-slate-700 rounded w-3/4 mt-1"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Question Heading (Matches original prompt) -->
                <div class="debate-question mb-8">
                    <h2 class="text-xl font-bold text-slate-900 dark:text-white leading-tight debate-title-text"></h2>
                    <div class="flex items-center gap-2 text-slate-500 dark:text-slate-400 text-[10px] font-medium mt-3 uppercase tracking-wide">
                        <span class="bg-slate-200 dark:bg-white/10 px-2 py-1 rounded">Decision Analysis</span>
                        <span>‚Ä¢</span>
                        <span class="model-count">3 Models</span>
                        <span>‚Ä¢</span>
                        <span class="status-time">Live</span>
                    </div>
                </div>

                <!-- Debate Tree Layout -->
                <div class="debate-tree relative flex flex-col gap-6">
                    <!-- Vertical Connector Line -->
                    <div class="absolute left-[19px] top-4 bottom-0 w-[2px] bg-slate-200 dark:bg-white/10 rounded-full"></div>
                    
                    <!-- Nodes will be injected here (Opener, Critiquer, etc.) -->
                    <div class="debate-nodes-container flex flex-col gap-6">
                        <div class="node-slot" data-role="opener"></div>
                        <div class="node-slot" data-role="critiquer"></div>
                        <div class="node-slot" data-role="synthesizer"></div>
                    </div>
                </div>

                <!-- Feedback Trigger Button -->
                <div class="feedback-trigger mt-6 flex justify-center" hidden>
                    <button class="open-feedback-modal flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-primary/10 to-secondary/10 border border-primary/20 text-sm font-medium text-slate-700 dark:text-slate-300 hover:border-primary transition-all">
                        <span class="material-symbols-outlined text-lg text-primary">rate_review</span>
                        <span>Rate this verdict</span>
                    </button>
                </div>

                <!-- Follow-up Suggestions -->
                <div class="follow-up-suggestions mt-8 pt-6 border-t border-slate-200 dark:border-white/10" hidden>
                    <div class="flex items-center gap-2 mb-4">
                        <span class="material-symbols-outlined text-primary">psychology_alt</span>
                        <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Continue exploring</h4>
                    </div>
                    <div class="follow-up-buttons flex flex-col gap-2">
                        <!-- Default follow-ups, will be replaced by JS with context-aware ones -->
                        <button class="follow-up-btn flex items-center gap-3 p-3 rounded-xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-card-dark/50 hover:border-primary transition-all text-left text-sm text-slate-700 dark:text-slate-300"
                            data-followup="What are the main risks I should consider?">
                            <span class="material-symbols-outlined text-primary text-lg">warning</span>
                            <span>What are the main risks I should consider?</span>
                        </button>
                        <button class="follow-up-btn flex items-center gap-3 p-3 rounded-xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-card-dark/50 hover:border-primary transition-all text-left text-sm text-slate-700 dark:text-slate-300"
                            data-followup="How can I validate this decision before committing?">
                            <span class="material-symbols-outlined text-primary text-lg">fact_check</span>
                            <span>How can I validate this decision before committing?</span>
                        </button>
                        <button class="follow-up-btn flex items-center gap-3 p-3 rounded-xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-card-dark/50 hover:border-primary transition-all text-left text-sm text-slate-700 dark:text-slate-300"
                            data-followup="What would you recommend as the next steps?">
                            <span class="material-symbols-outlined text-primary text-lg">arrow_forward</span>
                            <span>What would you recommend as the next steps?</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Argument Card Template -->
    <template id="argument-card-template">
        <div class="relative pl-12 group debate-node">
            <!-- Connector Dot -->
            <div class="connector-dot absolute left-[11px] top-6 w-[18px] h-[18px] rounded-full border-[3px] border-white dark:border-background-dark bg-primary shadow-sm z-10"></div>
            
            <!-- Connector Line Extension (For indented responses) -->
            <div class="connector-elbow absolute left-[19px] top-[-24px] bottom-auto h-[50px] w-8 border-l-[2px] border-b-[2px] border-slate-200 dark:border-white/10 rounded-bl-xl z-0 hidden"></div>

            <!-- Card -->
            <div class="relative bg-white dark:bg-card-dark rounded-xl shadow-sm border border-slate-200 dark:border-white/5 overflow-hidden transition-all hover:shadow-md">
                <div class="stance-indicator absolute left-0 top-0 bottom-0 w-1 bg-primary"></div>
                <div class="p-4">
                    <!-- Card Header -->
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex flex-col">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="stance-label text-[10px] font-bold uppercase tracking-wider text-primary">Stance: Unknown</span>
                                <span class="w-1 h-1 rounded-full bg-slate-300 dark:bg-slate-600"></span>
                                <span class="model-name text-[10px] font-medium text-slate-500 dark:text-slate-400">Model Name</span>
                            </div>
                            <h3 class="claim-text font-bold text-base text-slate-900 dark:text-white leading-snug"></h3>
                        </div>
                    </div>
                    
                    <!-- Card Body (Progressive Disclosure) -->
                    <div class="argument-details overflow-hidden transition-all">
                        <div class="explanation-text text-sm text-slate-600 dark:text-slate-400 leading-relaxed mb-3"></div>
                        <div class="extended-details hidden py-3 border-t border-slate-100 dark:border-white/5 space-y-3">
                            <div class="evidence-section">
                                <span class="text-[10px] font-bold uppercase text-slate-400">Supporting Evidence</span>
                                <p class="evidence-text text-sm mt-1"></p>
                            </div>
                            <div class="counter-section">
                                <span class="text-[10px] font-bold uppercase text-slate-400">Potential Counter</span>
                                <p class="counter-text text-sm mt-1 italic"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Card Footer -->
                    <div class="flex items-center justify-between pt-2 border-t border-slate-100 dark:border-white/5">
                        <div class="avatars-agree flex items-center -space-x-2">
                            <!-- Injected by JS -->
                        </div>
                        <button class="expand-argument-btn flex items-center gap-1 text-xs font-medium text-slate-500 dark:text-slate-400 hover:text-primary transition-colors">
                            <span class="btn-label">Expand</span> <span class="material-symbols-outlined text-lg">expand_more</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script src="/static/js/script.js"></script>
    <script>
        window.USER_IS_LOGGED_IN = {{ 'true' if user else 'false' }};
    </script>

    <!-- Register to Save Modal -->
    <div id="register-save-modal" class="modal-container">
        <div class="modal-content" style="text-align: center; max-width: 400px;">
            <button id="register-modal-close" class="modal-close-button">&times;</button>
            <h3 style="margin-bottom: 0.5rem;">Save your analysis</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Create a free account to save this debate
                and come back to it later.</p>
            <div style="margin-top: 1.5rem;">
                <a href="/register" id="btn-register-save" class="cta-button primary"
                    style="width: 100%; justify-content: center; text-decoration: none; display: flex;">Register Now</a>
            </div>
            <p style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-secondary);">
                Already have an account? <a href="/login" style="color: var(--accent-primary);">Login</a>
            </p>
        </div>
    </div>

    <!-- Feedback Modal Popup -->
    <div id="feedback-modal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-card-dark rounded-2xl shadow-2xl max-w-sm w-[90%] mx-auto p-6 animate-[scaleIn_0.2s_ease-out]">
            <div class="text-center mb-4">
                <span class="material-symbols-outlined text-4xl text-primary mb-2">rate_review</span>
                <h3 class="text-lg font-bold text-slate-900 dark:text-white">Was this verdict on point?</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Your feedback helps improve the council.</p>
            </div>
            
            <div class="feedback-rating-options flex justify-center gap-3 mb-4">
                <button class="feedback-option flex flex-col items-center gap-1 p-3 rounded-xl border border-slate-200 dark:border-white/10 hover:border-primary hover:bg-primary/5 transition-all" data-rating="helpful">
                    <span class="text-2xl">üëç</span>
                    <span class="text-xs font-medium text-slate-600 dark:text-slate-300">Helpful</span>
                </button>
                <button class="feedback-option flex flex-col items-center gap-1 p-3 rounded-xl border border-slate-200 dark:border-white/10 hover:border-primary hover:bg-primary/5 transition-all" data-rating="mixed">
                    <span class="text-2xl">üòê</span>
                    <span class="text-xs font-medium text-slate-600 dark:text-slate-300">Mixed</span>
                </button>
                <button class="feedback-option flex flex-col items-center gap-1 p-3 rounded-xl border border-slate-200 dark:border-white/10 hover:border-primary hover:bg-primary/5 transition-all" data-rating="off_target">
                    <span class="text-2xl">üëé</span>
                    <span class="text-xs font-medium text-slate-600 dark:text-slate-300">Off target</span>
                </button>
            </div>
            
            <textarea id="feedback-note" rows="2" class="w-full bg-slate-50 dark:bg-background-dark border border-slate-200 dark:border-white/10 rounded-lg p-3 text-sm focus:ring-2 focus:ring-primary outline-none mb-4 text-slate-900 dark:text-white" placeholder="Quick note for the council (optional)"></textarea>
            
            <div class="flex gap-3">
                <button id="feedback-skip" class="flex-1 py-2.5 rounded-lg border border-slate-200 dark:border-white/10 text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 transition-all">Maybe later</button>
                <button id="feedback-submit" class="flex-1 py-2.5 rounded-lg bg-primary text-white text-sm font-bold hover:opacity-90 transition-all disabled:opacity-50" disabled>Send</button>
            </div>
            
            <p id="feedback-status" class="text-xs text-center text-slate-500 mt-3" role="status"></p>
        </div>
    </div>

</body>

</html>